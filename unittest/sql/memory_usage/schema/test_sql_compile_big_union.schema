create database big_union;
use big_union;

CREATE TABLE `tp_nbv_relation_type` (`id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'primaryid', `typename` char(16) NOT NULL COMMENT '关系描述唯一字符串', `relation_desc` varchar(64) NOT NULL COMMENT '关系描述', PRIMARY KEY (`id`), UNIQUE KEY `type` (`typename`));
CREATE TABLE `tp_nbv_relations` (`id` int(11) NOT NULL AUTO_INCREMENT, `namespace_id` int(11) NOT NULL, `aid` char(128) NOT NULL COMMENT '资源id', `bid` char(255) NOT NULL COMMENT '资源id', `relatetype` int(11) NOT NULL COMMENT '关系描述，指向tp_nbv_relation_type的id', `state` int(11) NOT NULL DEFAULT '0' COMMENT '状态 0：默认初始状态 其他：按需求自定义', `createtime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, `cid` char(128) DEFAULT NULL COMMENT '资源id', PRIMARY KEY (`id`), UNIQUE KEY `res` (`aid`, `relatetype`, `bid`, `namespace_id`, `cid`), KEY `bid` (`bid`, `relatetype`, `aid`), KEY `tp_nbv_relations_relatetype_aid_bid_index` (`relatetype`, `aid`, `bid`));
CREATE TABLE `tp_nbv_yl_case` (`uuid` varchar(32) NOT NULL COMMENT '工作经历的唯一标识', `pid` varchar(32) NOT NULL COMMENT '用户id，指向tp_nbv_yl_patient的uuid', `did` varchar(32) NOT NULL COMMENT '用户id，指向tp_nbv_yl_doctor_cert的uuid', `hospital` varchar(255) DEFAULT NULL COMMENT 'type >= 0 :入职公司,type =-1，指向关联的工作经历id', `text` varchar(255) DEFAULT NULL COMMENT '工作经历的文字说明', `state` int(11) NOT NULL DEFAULT '0' COMMENT '当前工作经历拥有的资源，位与运算结果', `type` tinyint(4) DEFAULT '0' COMMENT '工作经历类型：-1：用户推送用户的工作经历；0：标准工作经历；1：预约记录；10：用户提交的记录', `createtime` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `modifytime` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '是不是改为预约时间了？', `duringtime` varchar(255) DEFAULT NULL COMMENT '预约时间段', `checktime` datetime NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT '入职时间', `hpid` varchar(20) NOT NULL COMMENT '公司系统内部的入职卡id', `jgid` int(11) NOT NULL COMMENT '入职公司id', `owner_jgid` int(11) DEFAULT '0' COMMENT '当前工作经历创建时，用户的主科室', `clinic_id` int(11) DEFAULT '0' COMMENT '用户端的入职卡id，指向yl_t_medical_card_relation的id', `submittime` bigint(20) DEFAULT '0' COMMENT '提交推送工作经历时刻的时间戳（微秒），用于比较时间', PRIMARY KEY (`uuid`), KEY `owner_jgid` (`owner_jgid`, `checktime`), KEY `did` (`did`, `pid`), KEY `tp_nbv_yl_case_jgid_pid_index` (`jgid`, `pid`), KEY `IDX_tp_nbv_yl_case_clinic_id` (`clinic_id`), KEY `tp_nbv_yl_case_hospital_index` (`hospital`), KEY `tp_nbv_yl_case_type_owner_jgid_index` (`type`, `owner_jgid`), KEY `tp_nbv_yl_case_type_did_index` (`type`, `did`), KEY `IDX_tp_nbv_yl_case_pid` (`pid`, `type`, `clinic_id`), KEY `tp_nbv_yl_case_createtime_index` (`createtime`));
CREATE TABLE `tp_nbv_yl_doctor_cert` (`uuid` varchar(32) NOT NULL COMMENT '用户的唯一标识', `uid` varchar(32) NOT NULL COMMENT '绑定的用户的id 指向tp_nbv_userinfo的uid', `idcard` varchar(24) DEFAULT NULL COMMENT '身份证号', `name` varchar(32) DEFAULT NULL COMMENT '姓名', `isrealname` int(1) NOT NULL DEFAULT '0' COMMENT '是否实名认证 0：否，1：是', `jobtitle` varchar(32) DEFAULT NULL COMMENT '用户姓名', `state` int(1) NOT NULL DEFAULT '0' COMMENT '认证结果：-1：审核未通过；0：待审核；1：审核通过；2：重新审核', `permitlogin` int(1) NOT NULL DEFAULT '1' COMMENT '是否允许登录 0：不允许，1：允许', `portrait` varchar(255) DEFAULT NULL COMMENT '头像地址', `createtime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, `modifytime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`uuid`), UNIQUE KEY `tp_nbv_yl_doctor_cert_uid_uindex` (`uid`));
CREATE TABLE `tp_nbv_yl_patient` (`uuid` varchar(32) NOT NULL COMMENT '用户的唯一标识', `uid` int(11) DEFAULT NULL COMMENT '绑定的用户的id 指向tp_nbv_userinfo的uid', `name` varchar(8) DEFAULT NULL COMMENT '用户的实名', `idcard` varchar(24) DEFAULT NULL COMMENT '用户的身份证号', `mobile` char(11) NOT NULL COMMENT '用户的手机号码', `male` int(1) NOT NULL DEFAULT '0' COMMENT '性别：0:未知；1:男；2：女', `birth` varchar(255) DEFAULT '9999-99-99' COMMENT '生日', `age` int(3) NOT NULL DEFAULT '-1' COMMENT '年龄', `height` varchar(8) DEFAULT NULL COMMENT '身高', `weight` varchar(8) DEFAULT NULL COMMENT '体重', `blood` varchar(8) DEFAULT NULL COMMENT '血型', `email` varchar(64) DEFAULT NULL COMMENT '邮箱', `weixin` varchar(64) DEFAULT NULL COMMENT '微信', `sidcard` char(16) DEFAULT NULL COMMENT '社保卡号', `createtime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间', `modifytime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间', `treattime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '入职时间', `clienttime` bigint(20) NOT NULL DEFAULT '0' COMMENT '同步时间戳', `entries` varchar(1024) NOT NULL DEFAULT '' COMMENT '用户 以空格分隔', `caseids` varchar(8192) NOT NULL DEFAULT '' COMMENT '用户 以空格分隔', `portrait` varchar(255) DEFAULT NULL COMMENT '头像地址', `labels` varchar(1024) DEFAULT '' COMMENT '标签 以空格分隔', `hassugar` tinyint(4) DEFAULT '0' COMMENT '是否有糖记录：0：没有，1：有', PRIMARY KEY (`uuid`), KEY `idcard` (`idcard`), KEY `IDX_tp_nbv_yl_patient_mobile` (`mobile`), KEY `IDX_tp_nbv_yl_patient_name` (`name`));
CREATE TABLE `tp_auth_permit` (`permitid` mediumint(8) NOT NULL AUTO_INCREMENT, `permit_level` int(11) NOT NULL COMMENT '权限级别0-n，0为最高级别', `parentid` int(11) NOT NULL COMMENT '父节点ID', `name` varchar(80) NOT NULL, `title` char(20) NOT NULL, `permit_type` int(11) NOT NULL DEFAULT '1', `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '0不启用，1启用', `condition` varchar(256) NOT NULL COMMENT '对应的url或唯一串', `order_idx` tinyint(4) NOT NULL, PRIMARY KEY (`permitid`), UNIQUE KEY `name` (`name`));
CREATE TABLE `tp_auth_permit2role` (`roleid` mediumint(8) NOT NULL DEFAULT '0' COMMENT '角色id，指向tp_auth_role的roleid', `permitid` int(11) NOT NULL COMMENT '具体权限id,指向tp_auth_permit的permitid', `cross_level` int(11) NOT NULL DEFAULT '0' COMMENT '跨级标志，0 仅限本机构，1 本机构+下属机构', PRIMARY KEY (`roleid`, `permitid`));
CREATE TABLE `tp_auth_role` (`roleid` mediumint(8) NOT NULL AUTO_INCREMENT COMMENT '角色id', `role_type` int(11) NOT NULL COMMENT '权限分类，与机构level对应', `role_type_ext` int(11) NOT NULL COMMENT '权限拓展分类，在权限分类中进一步分类，位与', `role_module` varchar(32) NOT NULL COMMENT '所属板块', `title` varchar(50) NOT NULL COMMENT '角色名称', `role_level` int(2) NOT NULL DEFAULT '1' COMMENT '级别0-n，0为最高级别', `parentid` int(8) NOT NULL COMMENT '父节点ID', `order_idx` int(4) NOT NULL, `uid` int(11) DEFAULT '0' COMMENT '该权限属于哪个用户 0：属于全局 其它属于指定用户', `name` varchar(32) DEFAULT NULL COMMENT '角色英文缩写', `desription` text DEFAULT NULL COMMENT '角色描述', `permit_group_local` json DEFAULT NULL COMMENT '本机构权限组列表', `permit_group_depart` json DEFAULT NULL COMMENT '对内部部门权限组列表', `del_flag` tinyint(1) NOT NULL DEFAULT '1' COMMENT '0不启用，1启用', `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`roleid`), UNIQUE KEY `name` (`name`));
CREATE TABLE `tp_auth_u2jg` (`id` int(11) NOT NULL AUTO_INCREMENT, `uid` int(11) NOT NULL COMMENT '用户ID', `jgid` int(11) NOT NULL COMMENT '机构ID', `roleid` int(11) unsigned NOT NULL COMMENT '角色ID tp_nbv_auth_group的id', `level_expand_flag` int(11) NOT NULL DEFAULT '0' COMMENT '权限向下扩展标志 0 限于本机构 1管理下属所有机构', `prime_flag` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '用户首选机构', `localid` varchar(32) DEFAULT NULL COMMENT '机构内编号：学号/工号/...', `del_flag` tinyint(4) NOT NULL DEFAULT '1' COMMENT '1:正常 0:删除 2：锁定;9:邀请中 7:已拒绝', `confirm_flag` int(11) NOT NULL DEFAULT '0' COMMENT '和机构产生关系的个人确认标志', `create_by` int(11) DEFAULT NULL COMMENT 'userinfo表uid', `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `update_by` int(11) DEFAULT NULL COMMENT 'userinfo表uid', `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`), UNIQUE KEY `jgid` (`jgid`, `localid`, `roleid`), UNIQUE KEY `idx_u2jg` (`uid`, `jgid`, `roleid`), KEY `roleid` (`roleid`), KEY `IDX_tp_nbv_auth_u2jg_access` (`jgid`, `roleid`, `del_flag`));
